<?xml version="1.0" encoding="utf-8"?>
<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs"
     xmlns:util="http://wixtoolset.org/schemas/v4/wxs/util">

  <Package Name="Mesch Jyro"
           Manufacturer="Mesch"
           Version="0.2.2"
           UpgradeCode="1691d170-6956-4764-9ec4-0a14a5849cce"
           InstallerVersion="500">

    <Media Id="1" Cabinet="MeschJyro.cab" EmbedCab="yes" />

    <MajorUpgrade DowngradeErrorMessage="A newer version is already installed." />

    <!-- Component group for all application files -->
    <ComponentGroup Id="MeschJyroComponents" Directory="INSTALLFOLDER">
      <Files Include="C:\GitHub\MeschSystems\Mesch.Jyro.Cli\Mesch.Jyro.Cli\bin\Release\net8.0\*.*" />
    </ComponentGroup>

    <!-- Start Menu shortcut -->
    <Component Id="StartMenuShortcut" Directory="ProgramMenuFolder">
      <Shortcut Id="MeschJyroShortcut"
                Name="Mesch Jyro"
                Target="[INSTALLFOLDER]Mesch.Jyro.exe"
                WorkingDirectory="INSTALLFOLDER" />
      <RegistryValue Root="HKCU"
                     Key="Software\Mesch\Mesch Jyro"
                     Name="installed"
                     Type="integer"
                     Value="1"
                     KeyPath="yes" />
    </Component>

    <!-- Add install folder to system PATH -->
    <Component Id="AddToPath" Guid="afca5863-15e2-4f95-9d16-8c32113b72a4">
      <Environment Id="AddMeschJyroToPath"
                        Name="Path"
                        Value="[INSTALLFOLDER]"
                        Action="set"
                        Part="last"
                        System="yes"
                        Permanent="no" />
    </Component>

    <!-- Create AppData\Roaming\Jyro folder for config files -->
    <Component Id="CreateAppDataFolder" Directory="JyroAppDataFolder" Guid="7c8f4b2a-1e3d-4a6f-9b5c-2d7e8f9a0b1c">
      <CreateFolder />
      <RegistryValue Root="HKCU"
                     Key="Software\Mesch\Mesch Jyro"
                     Name="AppDataFolder"
                     Type="integer"
                     Value="1"
                     KeyPath="yes" />
    </Component>

    <!-- Feature -->
    <Feature Id="Main">
      <ComponentGroupRef Id="MeschJyroComponents" />
      <ComponentRef Id="StartMenuShortcut" />
      <ComponentRef Id="AddToPath" />
      <ComponentRef Id="CreateAppDataFolder" />
    </Feature>

    <!-- Program Files install path -->
    <StandardDirectory Id="ProgramFiles64Folder">
      <Directory Id="DIR_MESCH" Name="Mesch">
        <Directory Id="INSTALLFOLDER" Name="Mesch Jyro" />
      </Directory>
    </StandardDirectory>

    <!-- AppData\Roaming\Jyro path for config files -->
    <StandardDirectory Id="AppDataFolder">
      <Directory Id="JyroAppDataFolder" Name="Jyro" />
    </StandardDirectory>

  </Package>
</Wix>
